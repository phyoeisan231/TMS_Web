"use strict";(self.webpackChunktms_gate=self.webpackChunktms_gate||[]).push([[618],{7618:(x,h,r)=>{r.r(h),r.d(h,{ProposalComponent:()=>F});var b=r(27),l=r(9417),c=r(9437),p=r(7673),D=r(7586),f=r.n(D),E=r(8032),a=r.n(E),e=r(3953),T=r(3542),_=r(6554),C=r(3782),m=r(8578),g=r(4088),v=r(3924),P=r(6674);const j=["Grid"],y=["closeModel"];function w(n,S){1&n&&(e.j41(0,"div",56),e.EFF(1,"Status Close Form"),e.k0s())}function M(n,S){if(1&n){const t=e.RV6();e.j41(0,"button",57),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onCloseFormSubmit())}),e.EFF(1,"Save"),e.k0s(),e.j41(2,"button",58),e.bIt("click",function(){e.eBV(t),e.XpG();const i=e.sdS(60);return e.Njj(i.hide())}),e.EFF(3,"Close"),e.k0s()}if(2&n){const t=e.XpG();e.Y8G("disabled",!t.closeForm.valid)}}let F=(()=>{class n{constructor(t,o,i){this.service=t,this.spinner=o,this.router=i,this.pageSettings={pageSize:50},this.editSettings={allowAdding:!0,allowDeleting:!0},this.toolbar=["Add",{text:"Edit",tooltipText:"Edit",prefixIcon:"e-icons e-edit",id:"edit"},{text:"Close Import",tooltipText:"Close Import",prefixIcon:"e-download",id:"close"},{text:"Truck Details",tooltipText:"Truck Details",prefixIcon:"e-icons e-selection",id:"detail"},{text:"Complete",tooltipText:"Complete",prefixIcon:"e-icons e-check",id:"complete"},"Delete","ExcelExport","Search"],this.lines="Both",this.submitClicked=!1,this.formatfilter="MM/dd/yyyy",this.deptTypeList=["CCA","Warehouse","Rail"],this.today=new Date,this.placeholder="Select One",this.jobDeptList=[],this.deptList=["CCA","Warehouse","Rail"],this.driverList=[]}ngOnInit(){this.mode="CheckBox",this.selectAllText="Select All",this.optionForm=new l.gE({fromDate:new l.MJ(sessionStorage.getItem("icfromDate")?sessionStorage.getItem("icfromDate"):this.today,l.k0.required),toDate:new l.MJ(sessionStorage.getItem("ictoDate")?sessionStorage.getItem("ictoDate"):this.today,l.k0.required),deptType:new l.MJ(sessionStorage.getItem("deptType")?sessionStorage.getItem("deptType").split(","):null,l.k0.required)}),this.closeForm=new l.gE({jobDept:new l.MJ("",l.k0.required),file:new l.MJ("",l.k0.required),uploadedFile:new l.MJ("")})}loadTableData(){this.spinner.show();const t=this.optionForm.value,o=f()(t.fromDate).format("MM/DD/YYYY"),i=f()(t.toDate).format("MM/DD/YYYY");sessionStorage.setItem("icfromDate",o),sessionStorage.setItem("ictoDate",i),sessionStorage.setItem("deptType",t.deptType);let s="";t.deptType.length>0&&(s=this.formatParams(t.deptType)),o&&i&&s&&this.service.getProposalList(o,i,s).pipe((0,c.W)(d=>(0,p.of)(this.showError(d)))).subscribe(d=>{this.grid.dataSource=d,this.spinner.hide()}),this.spinner.hide()}actionBegin(t){"add"===t.requestType&&(this.submitClicked=!1,this.router.navigate(["/tms-operation/proposal-form"])),"delete"===t.requestType&&(t.cancel=!0,this.deleteProposal(t.data[0].propNo))}formatParams(t){return t.map(o=>`'${o}'`).join(",")}handleFileInput(t){t.length>0&&this.closeForm.controls.uploadedFile.setValue(t.item(0))}deleteProposal(t){a().fire({title:"Are you sure?",text:"You will not be able to recover this data!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",cancelButtonText:"No, keep it",confirmButtonText:"Yes, I am sure!"}).then(o=>{o.value?(this.spinner.show(),this.service.deleteProposal(t).pipe((0,c.W)(i=>(0,p.of)(this.showError(i)))).subscribe(i=>{1==i.status?(this.showSuccess(i.messageContent),this.loadTableData()):(this.spinner.hide(),a().fire("TMS Proposal",i.messageContent,"error"))})):o.dismiss===a().DismissReason.cancel&&a().close()})}completeProposal(t,o){a().fire({title:"Are you sure?",text:"This proposal will be completed!",icon:"warning",showCancelButton:!0,confirmButtonColor:"blue",cancelButtonText:"No, keep it",confirmButtonText:"Yes, I am sure!"}).then(i=>{i.value?(this.spinner.show(),this.service.completeProposal(t,o).pipe((0,c.W)(s=>(0,p.of)(this.showError(s)))).subscribe(s=>{1==s.status?(this.showSuccess(s.messageContent),this.loadTableData()):(this.spinner.hide(),a().fire("TMS Proposal",s.messageContent,"error"))})):i.dismiss===a().DismissReason.cancel&&a().close()})}onCloseFormSubmit(){const t=this.closeForm.value,o=new FormData;o.append("UploadedFile",t.uploadedFile),o.append("JobDept",t.jobDept),this.statusChange(o)}statusChange(t){this.closeModel.hide(),this.spinner.show(),this.service.statusChange(t).pipe((0,c.W)(o=>(0,p.of)(this.showError(o)))).subscribe(o=>{1==o.status?(a().fire("Proposal",o.message+"Job Code "+o.messageContent,"success"),this.loadTableData()):(this.spinner.hide(),a().fire("Proposal",o.messageContent,"error"))})}createProposalDetail(t){this.spinner.show(),this.service.createProposalDetail(t).pipe((0,c.W)(o=>(0,p.of)(this.showError(o)))).subscribe(o=>{1==o.status?(this.showSuccess(o.messageContent),this.router.navigate(["/tms-operation/proposal"])):(this.spinner.hide(),a().fire("Proposal",o.messageContent,"error"))})}showSuccess(t){this.spinner.hide(),a().fire("TMS Proposal",t,"success")}showError(t){this.spinner.hide(),a().fire("TMS Proposal",t.statusText,"error")}toolbarClick(t){if("Excel Export"===t.item.text&&this.grid.excelExport({fileName:"Proposal.xlsx"}),"close"===t.item.id&&(this.closeForm.reset(),this.closeForm.controls.jobDept.setValue(this.jobDept),this.closeModel.show()),"detail"===t.item.id||"edit"===t.item.id||"complete"===t.item.id){let o=this.grid.getSelectedRecords();if(0==o.length)a().fire("TMS Proposal","Please select one row!","warning");else{const i=o[0].propNo;this.jobDept=o[0].jobDept;const s=localStorage.getItem("currentUser");if("detail"===t.item.id)return void this.router.navigate(["/tms-operation/proposal-detail"],{queryParams:{id:i}});if("edit"===t.item.id)this.router.navigate(["/tms-operation/proposal-form"],{queryParams:{id:i}});else if("complete"===t.item.id)return void this.completeProposal(i,s)}}}validateControl(t){const o=this.closeForm.get(t);return o.invalid&&(o.dirty||o.touched)||o.invalid&&this.submitClicked}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(T.a),e.rXU(_.ex),e.rXU(C.Ix))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-proposal"]],viewQuery:function(o,i){if(1&o&&(e.GBs(j,5),e.GBs(y,5)),2&o){let s;e.mGM(s=e.lsd())&&(i.grid=s.first),e.mGM(s=e.lsd())&&(i.closeModel=s.first)}},standalone:!0,features:[e.aNF],decls:86,vars:26,consts:[["Grid",""],["closeModel",""],["header",""],["footerTemplate",""],[1,"content","mt-0"],[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/","routerLinkActive","active"],[1,"nav-icon","fas","fa-tachometer-alt"],[1,"breadcrumb-item","active","text-primary"],[1,"card","card-primary","card-outline"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"col-md-12","col-lg-12","text-left"],[3,"formGroup"],[1,"row","btns","mb-2"],[1,"col-lg-5","col-12"],["for","fromDate",1,"col-sm-4","col-form-label","requiredfield"],[1,"col-sm-8","p-0"],["formControlName","fromDate","floatLabelType","Always",3,"format"],["for","toDate",1,"col-sm-4","col-form-label","requiredfield"],["formControlName","toDate","floatLabelType","Always",3,"format"],[1,"row","mb-2"],[1,"col-sm-4","col-form-label","requiredfield"],["formControlName","deptType","tabindex","4","showSelectAll","true",3,"dataSource","mode","placeholder","selectAllText"],[1,"col-lg-2","col-12","justify-content-end"],["type","button",1,"btn","btn-sm","btn-primary",3,"click","disabled"],[1,"fas","fa-eye"],[3,"actionBegin","toolbarClick","dataSource","allowResizing","allowSorting","allowPaging","pageSettings","editSettings","allowExcelExport","toolbar","gridLines"],["field","yard","headerText","Yard","width","100"],["field","estDate","headerText","Estimate Date","type","date","format","dd-MM-yyyy","width","130"],["field","jobCode","headerText","JobCode","width","100"],["field","jobDept","headerText","JobDept","width","150"],["field","jobType","headerText","JobType","width","100"],["field","noOfTruck","headerText","NoOfTruck","width","100"],["field","noOfTEU","headerText","NoOfTEU","width","100"],["field","noOfFEU","headerText","NoOfFEU","width","100"],["field","lclQty","headerText","LCLQty","width","100"],["field","areaID","headerText","Operation Area","width","250"],["field","pcCode","headerText","Category","width","100"],["field","status","headerText","Status","width","100"],["isModal","true","height","48%","width","500px","allowDragging","true",3,"showCloseIcon","visible"],[1,"form-group","col-md-12"],[1,"requiredfield"],["formControlName","jobDept","tabindex","3","popupHeight","200px","placeholder","Select One",3,"dataSource"],[1,"e-error",2,"display","block"],[1,"e-float-input","e-control-wrapper"],["formControlName","file","id","file","type","file","accept",".xlsx",2,"padding-top","2px",3,"change"],[1,"e-float-line"],["for","file",1,"e-float-text","e-label-top","requiredfield"],["bdColor","rgba(0, 0, 0, 0.8)","size","medium","color","#fff","type","square-jelly-box",3,"fullScreen"],[2,"color","white"],[1,"font-weight-bold"],["type","submit","ejs-button","",1,"e-edit-dialog","e-control","e-btn","e-lib","e-primary","e-flat",3,"click","disabled"],["ejs-button","",1,"e-edit-dialog","e-control","e-btn","e-lib","e-flat",3,"click"]],template:function(o,i){if(1&o){const s=e.RV6();e.j41(0,"section",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"ol",8)(5,"li",9)(6,"a",10),e.nrm(7,"i",11),e.EFF(8,"\xa0Dashboard"),e.k0s()(),e.j41(9,"li",12),e.EFF(10,"TMS Proposal"),e.k0s()()()(),e.j41(11,"div",6)(12,"div",13)(13,"div",14)(14,"h5",15),e.EFF(15,"TMS Proposal"),e.k0s()(),e.j41(16,"div",16)(17,"div",6)(18,"div",17)(19,"Form",18)(20,"div",19)(21,"div",20)(22,"div",6)(23,"label",21),e.EFF(24,"Date:"),e.k0s(),e.j41(25,"div",22),e.nrm(26,"ejs-datepicker",23),e.k0s()()(),e.j41(27,"div",20)(28,"div",6)(29,"label",24),e.EFF(30,"To:"),e.k0s(),e.j41(31,"div",22),e.nrm(32,"ejs-datepicker",25),e.k0s()()()(),e.j41(33,"div",26)(34,"div",20)(35,"div",6)(36,"label",27),e.EFF(37,"Dept Type:"),e.k0s(),e.j41(38,"div",22),e.nrm(39,"ejs-multiselect",28),e.k0s()()(),e.j41(40,"div",29)(41,"button",30),e.bIt("click",function(){return e.eBV(s),e.Njj(i.loadTableData())}),e.nrm(42,"i",31),e.EFF(43," \xa0 View "),e.k0s()()()()()(),e.j41(44,"ejs-grid",32,0),e.bIt("actionBegin",function(u){return e.eBV(s),e.Njj(i.actionBegin(u))})("toolbarClick",function(u){return e.eBV(s),e.Njj(i.toolbarClick(u))}),e.j41(46,"e-columns"),e.nrm(47,"e-column",33)(48,"e-column",34)(49,"e-column",35)(50,"e-column",36)(51,"e-column",37)(52,"e-column",38)(53,"e-column",39)(54,"e-column",40)(55,"e-column",41)(56,"e-column",42)(57,"e-column",43)(58,"e-column",44),e.k0s()()()()()(),e.j41(59,"ejs-dialog",45,1),e.DNE(61,w,2,0,"ng-template",null,2,e.C5r),e.j41(63,"form",18)(64,"div",6)(65,"div",46)(66,"label",47),e.EFF(67,"Job Dept"),e.k0s(),e.nrm(68,"ejs-dropdownlist",48),e.j41(69,"div")(70,"label",49),e.EFF(71,"*Job Dept is required"),e.k0s()()(),e.j41(72,"div",46)(73,"div",50)(74,"input",51),e.bIt("change",function(u){return e.eBV(s),e.Njj(i.handleFileInput(u.target.files))}),e.k0s(),e.nrm(75,"span",52),e.j41(76,"label",53),e.EFF(77,"Excel File"),e.k0s()(),e.j41(78,"div")(79,"label",49),e.EFF(80,"* Import file is required"),e.k0s()()()(),e.DNE(81,M,4,1,"ng-template",null,3,e.C5r),e.k0s()()(),e.j41(83,"ngx-spinner",54)(84,"p",55),e.EFF(85," Loading... "),e.k0s()()}2&o&&(e.R7$(19),e.Y8G("formGroup",i.optionForm),e.R7$(7),e.Y8G("format",i.formatfilter),e.R7$(6),e.Y8G("format",i.formatfilter),e.R7$(7),e.Y8G("dataSource",i.deptTypeList)("mode",i.mode)("placeholder",i.placeholder)("selectAllText",i.selectAllText),e.R7$(2),e.Y8G("disabled",!i.optionForm.valid),e.R7$(3),e.Y8G("dataSource",i.data)("allowResizing",!0)("allowSorting",!0)("allowPaging",!0)("pageSettings",i.pageSettings)("editSettings",i.editSettings)("allowExcelExport",!0)("toolbar",i.toolbar)("gridLines",i.lines),e.R7$(15),e.Y8G("showCloseIcon",!0)("visible",!1),e.R7$(4),e.Y8G("formGroup",i.closeForm),e.R7$(5),e.Y8G("dataSource",i.deptList),e.R7$(),e.xc7("visibility",i.validateControl("jobDept")?"visible":"hidden"),e.R7$(9),e.xc7("visibility",i.validateControl("jobDept")?"visible":"hidden"),e.R7$(5),e.Y8G("fullScreen",!0))},dependencies:[b.Q,l.qT,l.me,l.BC,l.cb,l.j4,l.JD,m._ab,m.eeu,m.rFS,m.LGG,m.cvh,g.V9,v.I,P.mq,g.b3,_.et]})}return n})()}}]);